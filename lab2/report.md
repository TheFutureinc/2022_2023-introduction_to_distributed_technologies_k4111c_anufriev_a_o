Лабораторная работа №2 "Развертывание веб сервиса в Minikube, доступ к веб интерфейсу сервиса. Мониторинг сервиса."
Общая информация
University: ITMO University
Faculty: FICT
Course: Introduction to distributed technologies
Year: 2022/2023
Group: K4113c
Author: Anufriev Artem Olegovich
Lab: Lab2
Date of create: 17.03.2023
Date of finished:
Ход работы
Создание Deployment
Для развертывания приложения был создан манифест deployment.yaml. Deployment - это абстракция Kubernetes, которая позволяет управлять приложением, его версиями и обновлениями. В объекте Deployment хранится информация о конфигурации подов, количестве необходимых реплик и методе обновления подов в случае изменения их конфигурации.
При развертывании deployment создается еще одна абстракция - ReplicaSet. Она отвечает за описание и контроль за несколькими экземплярами приложений.
Для развертывания deployment используем следующую команду:

 <img width="348" alt="image" src="https://user-images.githubusercontent.com/46056823/225920679-8978216a-5adf-4679-a0e3-9055bf7c3f14.png">

Создание Service типа LoadBalancer
Для предоставления доступа к подам деплоймента lab2-app был создан манифест service.yaml. Данный манифест определяет Service типа LoadBalancer и выбирает поды, которые имеют selectorLabel app=lab2-app.
Сервисы в Kubernetes позволяют определить набор подов и правила доступа к ним. С помощью сервисов разные части приложения могут "общаться" друг с другом (например, фронтенд с бэкендом).
Для создания описанного в манифесте сервиса была использована следующая команда:

 <img width="345" alt="image" src="https://user-images.githubusercontent.com/46056823/225920828-7d724d78-40d9-4b99-a534-d73703566abe.png">

Для того, чтобы определить правильно ли настроены селекторы для подов, выведем описание созданного сервиса:

 <img width="268" alt="image" src="https://user-images.githubusercontent.com/46056823/225920801-0bd2f7ed-0f04-4c3d-8920-fa0d88aedc03.png">

В строке Enpoints приведены IP адреса подов, на которые сервис будет проксировать трафик. Сравним их с IP-адресам подов деплоймента lab2-app:

 <img width="468" alt="image" src="https://user-images.githubusercontent.com/46056823/225920776-ab37810c-860f-45ac-ae2a-b041fe64ea2f.png">

Как видно из вывода - IP-адреса совпадают.
Тестирование работы сервиса
Minikube tunnel. 
Данная команда дает возможность получить доступ к сервису типа LoadBalancer на хосте. Используем ее для тестирования нашего приложения.
После выполнения данной команды откроем в браузере страницу http://localhost:3000 и обновим несколько раз.

 <img width="468" alt="image" src="https://user-images.githubusercontent.com/46056823/225920894-6b552ef6-0770-4f5d-81ed-79e6386d2aae.png">

После обновления страницы, имя и IP контейнера изменяется. Это происходит потому, что сервис проксирует запросы то на один под, то на другой.
Схема организации контейнеров и сервисов

<img width="468" alt="image" src="https://user-images.githubusercontent.com/46056823/225920877-c89025e5-46c8-4e47-8aa1-89be713a016c.png">
